name: Vercel Preview Smoke

on:
  deployment_status:

concurrency:
  group: vercel-smoke-${{ github.event.deployment.id }}
  cancel-in-progress: true

jobs:
  smoke:
    if: ${{ github.event.deployment_status.state == 'success' }}
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Preview URL
        run: echo "${{ github.event.deployment_status.target_url }}"

      - name: Smoke test (HTTP 200)
        run: |
          URL="${{ github.event.deployment_status.target_url }}"
          curl -fsS "$URL/" > /dev/null

      - name: Assert SSR actually ran (optional)
        run: |
          URL="${{ github.event.deployment_status.target_url }}"
          # busca algo t√≠pico de Angular SSR/hydration si lo tienes
          html="$(curl -fsS "$URL/")"
          echo "$html" | grep -qi "<app-root" || (echo "No app-root found" && exit 1)
